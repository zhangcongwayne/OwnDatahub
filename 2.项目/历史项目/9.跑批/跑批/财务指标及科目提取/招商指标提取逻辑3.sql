/*select * from exposure_factor_xw where factor_cd like 'zs_factor%';
select * from exposure where exposure_sid=6355;*/
-------------------------------------------------------融资平台----------------------
with records as (select cb.company_id, cb.company_nm,zs.exposure, 
 to_char(cf.rpt_dt,'yyyymmdd') as rpt_dt,
cf.factor_cd, cf.factor_value from 
(select b.exposure,a.* from compy_exposure a join exposure b on a.exposure_sid = b.exposure_sid where a.client_id=5 and a.is_new=1 and a.isdel=0) zs 
join compy_basicinfo cb on cb.company_id=zs.company_id and cb.is_del=0  and zs.exposure ='融资平台'
JOIN compy_factor_finance  cf  ON cb.company_id=cf.company_id  and cf.exposure_sid=zs.exposure_sid --指标值限制取最新敞口信息
and cf.rpt_timetype_cd=1 and factor_value is not null and  to_char(cf.rpt_dt,'yyyymmdd')='20161231') 
SELECT * FROM (SELECT EXPOSURE ,COMPANY_ID,COMPANY_NM,RPT_DT, FACTOR_CD,FACTOR_VALUE FROM RECORDS) PIVOT (SUM(FACTOR_VALUE) FOR FACTOR_CD IN
('Growth1',
'Growth2',
'Growth3',
'Growth4',
'Growth5',
'Growth6',
'Growth7',
'Growth8',
'Growth9',
'Leverage1',
'Leverage010',
'Leverage011',
'Leverage012',
'Leverage13',
'Leverage14',
'Leverage15',
'Leverage16',
'Leverage17',
'Leverage18',
'Leverage19',
'Leverage2',
'Leverage20',
'Leverage21',
'Leverage22',
'Leverage23',
'Leverage24',
'Leverage3',
'Leverage4',
'Leverage5',
'Leverage6',
'Leverage07',
'Leverage8',
'Leverage09',
'Operation1',
'Operation10',
'Operation11',
'Operation12',
'Operation13',
'Operation14',
'Operation15',
'Operation2',
'Operation3',
'Operation4',
'Operation5',
'Operation6',
'Operation7',
'Operation8',
'Operation9',
'Profitability1',
'Profitability10',
'Profitability11',
'Profitability12',
'Profitability13',
'Profitability14',
'Profitability15',
'Profitability16',
'Profitability17',
'Profitability18',
'Profitability2',
'Profitability3',
'Profitability4',
'Profitability5',
'Profitability6',
'Profitability7',
'Profitability8',
'Profitability9',
'Size1',
'Size10',
'Size2',
'Size3',
'Size4',
'Size5',
'Size6',
'Size7',
'Size8',
'Size9',
'Specific1',
'Specific2',
'Specific3',
'Specific4',
'Specific5',
'Specific6',
'Specific7',
'Specific8',
'Specific9',
'Structure1',
'Structure10',
'Structure11',
'Structure12',
'Structure13',
'Structure14',
'Structure15',
'Structure16',
'Structure17',
'Structure18',
'Structure019',
'Structure2',
'Structure3',
'Structure4',
'Structure5',
'Structure6',
'Structure7',
'Structure8',
'Structure9',
'zs_factor_01',
'zs_factor_02',
'zs_factor_03',
'zs_factor_04',
'zs_factor_05',
'zs_factor_06',
'zs_factor_07',
'zs_factor_08',
'zs_factor_09',
'zs_factor_10',
'zs_factor_11',
'zs_factor_12',
'zs_factor_13',
'zs_factor_14',
'zs_factor_15',
'zs_factor_16',
'zs_factor_17',
'zs_factor_18',
'zs_factor_19',
'zs_factor_20',
'zs_factor_21',
'zs_factor_22',
'zs_factor_23',
'zs_factor_24',
'zs_factor_25',
'zs_factor_26',
'zs_factor_27',
'zs_factor_28',
'zs_factor_29',
'zs_factor_30',
'zs_factor_31',
'zs_factor_32',
'zs_factor_33',
'zs_factor_34',
'zs_factor_35'/*,
'zs_factor_36',
'zs_factor_37'*/
));

-------------------------------------------------------非融资平台非金融机构----------------------
with records as (select cb.company_id, cb.company_nm,zs.exposure, 
 to_char(cf.rpt_dt,'yyyymmdd') as rpt_dt,
cf.factor_cd, cf.factor_value from 
(select b.exposure,a.* from compy_exposure a join exposure b on a.exposure_sid = b.exposure_sid where a.client_id=5 and a.is_new=1 and a.isdel=0) zs 
join compy_basicinfo cb on cb.company_id=zs.company_id and cb.is_del=0  and zs.exposure not in ('融资平台','证券','银行')
JOIN compy_factor_finance  cf  ON cb.company_id=cf.company_id  and cf.exposure_sid=zs.exposure_sid --指标值限制取最新敞口信息
and cf.rpt_timetype_cd=1 and factor_value is not null and  to_char(cf.rpt_dt,'yyyymmdd')='20161231') 
SELECT * FROM (SELECT EXPOSURE ,COMPANY_ID,COMPANY_NM,RPT_DT, FACTOR_CD,FACTOR_VALUE FROM RECORDS) PIVOT (SUM(FACTOR_VALUE) FOR FACTOR_CD IN
('Growth1',
'Growth2',
'Growth3',
'Growth4',
'Growth5',
'Growth6',
'Growth7',
'Growth8',
'Growth9',
'Leverage1',
'Leverage010',
'Leverage011',
'Leverage012',
'Leverage13',
'Leverage14',
'Leverage15',
'Leverage16',
'Leverage17',
'Leverage18',
'Leverage19',
'Leverage2',
'Leverage20',
'Leverage21',
'Leverage22',
'Leverage23',
'Leverage24',
'Leverage3',
'Leverage4',
'Leverage5',
'Leverage6',
'Leverage07',
'Leverage8',
'Leverage09',
'Operation1',
'Operation10',
'Operation11',
'Operation12',
'Operation13',
'Operation14',
'Operation15',
'Operation2',
'Operation3',
'Operation4',
'Operation5',
'Operation6',
'Operation7',
'Operation8',
'Operation9',
'Profitability1',
'Profitability10',
'Profitability11',
'Profitability12',
'Profitability13',
'Profitability14',
'Profitability15',
'Profitability16',
'Profitability17',
'Profitability18',
'Profitability2',
'Profitability3',
'Profitability4',
'Profitability5',
'Profitability6',
'Profitability7',
'Profitability8',
'Profitability9',
'Size1',
'Size10',
'Size2',
'Size3',
'Size4',
'Size5',
'Size6',
'Size7',
'Size8',
'Size9',
'Specific1',
'Specific2',
'Specific3',
'Specific4',
'Specific5',
'Specific6',
'Specific7',
'Specific8',
'Specific9',
'Structure1',
'Structure10',
'Structure11',
'Structure12',
'Structure13',
'Structure14',
'Structure15',
'Structure16',
'Structure17',
'Structure18',
'Structure019',
'Structure2',
'Structure3',
'Structure4',
'Structure5',
'Structure6',
'Structure7',
'Structure8',
'Structure9',
/*'zs_factor_01',
'zs_factor_02',
'zs_factor_03',
'zs_factor_04',
'zs_factor_05',
'zs_factor_06',
'zs_factor_07',
'zs_factor_08',
'zs_factor_09',
'zs_factor_10',
'zs_factor_11',
'zs_factor_12',
'zs_factor_13',
'zs_factor_14',
'zs_factor_15',
'zs_factor_16',
'zs_factor_17',
'zs_factor_18',
'zs_factor_19',
'zs_factor_20',
'zs_factor_21',*/
'zs_factor_22',
/*'zs_factor_23',
'zs_factor_24',
'zs_factor_25',
'zs_factor_26',
'zs_factor_27',
'zs_factor_28',
'zs_factor_29',
'zs_factor_30',
'zs_factor_31',
'zs_factor_32',
'zs_factor_33',
'zs_factor_34',
'zs_factor_35',*/
'zs_factor_36',
'zs_factor_37'
));
------------------------------------------------------------------------------------------------证券
with records as (select cb.company_id, cb.company_nm,zs.exposure, 
 to_char(cf.rpt_dt,'yyyymmdd') as rpt_dt,
cf.factor_cd, cf.factor_value from  (select b.exposure,a.* from compy_exposure a join exposure b on a.exposure_sid = b.exposure_sid where a.client_id=5 and a.is_new=1 and a.isdel=0) zs  
join compy_basicinfo cb on cb.company_id=zs.company_id and cb.is_del=0 and  zs.exposure in ('证券公司')
JOIN compy_factor_finance  cf  ON cb.company_id=cf.company_id  and cf.exposure_sid=zs.exposure_sid --指标值限制取最新敞口信息
and cf.rpt_timetype_cd=1 and factor_value is not null and  to_char(cf.rpt_dt,'yyyymmdd')='20161231') 
SELECT * FROM (SELECT EXPOSURE ,COMPANY_ID,COMPANY_NM,RPT_DT, FACTOR_CD,FACTOR_VALUE FROM RECORDS) PIVOT (SUM(FACTOR_VALUE) FOR FACTOR_CD IN
(
'Secu_Growth1',
'Secu_Growth2',
'Secu_Growth3',
'Secu_Growth4',
'Secu_Growth5',
'Secu_Growth6',
'Secu_Growth7',
'Secu_Leverage1',
'Secu_Leverage2',
'Secu_Leverage3',
'Secu_Leverage4',
'Secu_Leverage5',
'Secu_Leverage6',
'Secu_Profitability1',
'Secu_Profitability2',
'Secu_Profitability3',
'Secu_Profitability4',
'Secu_Profitability5',
'Secu_Profitability6',
'Secu_Profitability7',
'Secu_Profitability8', 
'Secu_Regulatory01',
'Secu_Regulatory02',
'Secu_Regulatory03',
'Secu_Regulatory04',
'Secu_Size010',
'Secu_Size011',
'Secu_Size1', 
'Secu_Size2',
'Secu_Size3',
'Secu_Size4',
'Secu_Size5',
'Secu_Size6',
'Secu_Size7',
'Secu_Size8',
'Secu_Size9',
'Secu_Structure1',
'Secu_Structure2',
'Secu_Structure3',
'Secu_Structure4' ,
'zs_factor_22'
));

---------------------------------------------------------------------------------------银行
with records as (select cb.company_id, cb.company_nm,zs.exposure, 
 to_char(cf.rpt_dt,'yyyymmdd') as rpt_dt,
cf.factor_cd, cf.factor_value from  (SELECT B.EXPOSURE,A.* FROM COMPY_EXPOSURE A JOIN EXPOSURE B ON A.EXPOSURE_SID = B.EXPOSURE_SID WHERE A.CLIENT_ID=5 and a.is_new=1 and a.isdel=0) zs  
join compy_basicinfo cb on cb.company_id=zs.company_id  and cb.is_del=0 and  zs.exposure in ('银行')
JOIN compy_factor_finance  cf  ON cb.company_id=cf.company_id  and cf.exposure_sid=zs.exposure_sid --指标值限制取最新敞口信息
and cf.rpt_timetype_cd=1 and factor_value is not null and  to_char(cf.rpt_dt,'yyyymmdd')='20161231') 
SELECT * FROM (SELECT EXPOSURE,COMPANY_ID,COMPANY_NM,RPT_DT, FACTOR_CD,FACTOR_VALUE FROM RECORDS) PIVOT (SUM(FACTOR_VALUE) FOR FACTOR_CD IN
(
'zs_Bank_Growth1',
'zs_Bank_Growth2',
'zs_Bank_Growth3',
'zs_Bank_Growth4',
'zs_Bank_Growth5',
'zs_Bank_Growth6',
'zs_Bank_Growth7',
'zs_Bank_Growth8',
'zs_Bank_Growth9',
'zs_Bank_Leverage1',
'zs_Bank_Leverage2',
'zs_Bank_Leverage3',
'zs_Bank_Liquidity1',
'zs_Bank_Liquidity2',
'zs_Bank_Liquidity3',
'zs_Bank_Liquidity4',
'zs_Bank_Profitability1',
'zs_Bank_Profitability10',
'zs_Bank_Profitability11',
'zs_Bank_Profitability12',
'zs_Bank_Profitability2',
'zs_Bank_Profitability3',
'zs_Bank_Profitability4',
'zs_Bank_Profitability5',
'zs_Bank_Profitability6',
'zs_Bank_Profitability7',
'zs_Bank_Profitability8',
'zs_Bank_Profitability9',
'zs_Bank_Size1',
'zs_Bank_Size2',
'zs_Bank_Size3',
'zs_Bank_Size4',
'zs_Bank_Size5' ,
'zs_factor_22'
));
